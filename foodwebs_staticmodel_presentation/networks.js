function containsObject(e,t){for(var n=0;n<e.length;n++)if(e[n].source==t.source&&e[n].target==t.target)return!0;return!1}function contains(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return!1}function getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}function getRandomArbitrary(e,t){return Math.random()*(t-e)+e}function getPropsAsList(e){for(var t=[],n=[],r=0;r<e.links.length;r++)t.push(e.links[r].source),n.push(e.links[r].target);return[t,n]}function calcGroups(e){for(var t=0;t<e.nodes.length;t++)propList=getPropsAsList(e),sourceList=propList[0],targetList=propList[1],0==contains(sourceList,e.nodes[t].id)&&(e.nodes[t].group="top"),0==contains(targetList,e.nodes[t].id)&&(e.nodes[t].group="basal"),0==document.getElementById("checkConnected").checked&&0==contains(sourceList,e.nodes[t].id)&&0==contains(targetList,e.nodes[t].id)&&(e.nodes[t].group="notConnected")}function isConnected(e){function t(e){for(retlistSourcTarg=[],i=0;i<e.links.length;i++)retlistSourcTarg.push([e.links[i].source,e.links[i].target]);return retlistSourcTarg}function n(e,t){for(var n=0;n<e.length;n++)if((e[n][0]==t||e[n][1]==t)&&e[n][0]!=e[n][1])return!0;return!1}var r=t(e);for(j=0;j<e.nodes.length;j++)if(0==n(r,e.nodes[j].id))return!1;return!0}function calcGraphRandom(e,t){for(var n=t/(e*e),r={nodes:[],links:[]},a=1;a<=e;a++)r.nodes.push({id:"n"+a,group:"intermediate"});for(var o=0;o<t;){let t="n"+(getRandomInt(e)+1),a="n"+(getRandomInt(e)+1);Math.random()<=n&&0==containsObject(r.links,{source:t,target:a})&&(r.links.push({source:t,target:a}),o++)}return calcGroups(r),r}function calcGraphCascade(e,t){for(var n=2*t/(e*(e-1)),r={nodes:[],links:[]},a=1;a<=e;a++)r.nodes.push({id:"n"+a,group:"intermediate"});for(var o=0;o<t;){let t=getRandomInt(e)+1;if(1==t)continue;let a="n"+t,i="n"+(getRandomInt(t-1)+1);Math.random()<=n&&0==containsObject(r.links,{source:i,target:a})&&(r.links.push({source:i,target:a}),o++)}return calcGroups(r),r}function compare(e,t){return e.nichevalue>t.nichevalue?1:e.nichevalue<t.nichevalue?-1:0}function getIntervallWidth(e,t){for(;;){var n=parseFloat(Math.random());if(0!=n)break}return parseFloat(e*(1-Math.pow(1-n,1/t)))}function isinIntervall(e,t,n){return parseFloat(e)>=parseFloat(t)&&parseFloat(e)<=parseFloat(n)}function calcGraphNiche(e,t){var n,r,a,o,i,d,c,l,s=parseFloat(t/(e*e)),u=parseFloat(1/(2*s)-1);if(0!=e){for(;;){l={nodes:[],links:[]};for(var p=1;p<=e;p++)l.nodes.push({nichevalue:Math.random()});l.nodes=l.nodes.sort(compare);for(p=1;p<=e;p++)l.nodes[p-1].group="intermediate",l.nodes[p-1].id="n"+p;for(p=0;p<e;p++){n=parseFloat(l.nodes[p].nichevalue),r=parseFloat(getIntervallWidth(n,u)),n<=1-r/2?a=parseFloat(getRandomArbitrary(r/2,n)):n>1-r/2&&(a=parseFloat(getRandomArbitrary(r/2,1-r/2)));for(var g=0;g<e;g++)isinIntervall(parseFloat(l.nodes[g].nichevalue),parseFloat(a)-parseFloat(r/2),parseFloat(a)+parseFloat(r/2))&&l.links.push({source:l.nodes[g].id,target:l.nodes[p].id})}if(o=l.nodes.length,i=l.links.length,c=i/(o*o),d=parseFloat(document.getElementById("inputconnErr").value),isinIntervall(c,s-d,s+d))break}return calcGroups(l),l}return{nodes:[],links:[]}}function calcFinalGraphs(){if(document.getElementById("checkConnected").checked){for(;graph1=calcGraphRandom(parseInt(document.getElementById("inputfieldSpecies").value,10),parseInt(document.getElementById("inputfieldLinkNum").value,10)),!isConnected(graph1););for(;graph2=calcGraphCascade(parseInt(document.getElementById("inputfieldSpecies").value,10),parseInt(document.getElementById("inputfieldLinkNum").value,10)),!isConnected(graph2););for(;graph3=calcGraphNiche(parseInt(document.getElementById("inputfieldSpecies").value,10),parseInt(document.getElementById("inputfieldLinkNum").value,10)),!isConnected(graph3););}else graph1=calcGraphRandom(parseInt(document.getElementById("inputfieldSpecies").value,10),parseInt(document.getElementById("inputfieldLinkNum").value,10)),graph2=calcGraphCascade(parseInt(document.getElementById("inputfieldSpecies").value,10),parseInt(document.getElementById("inputfieldLinkNum").value,10)),graph3=calcGraphNiche(parseInt(document.getElementById("inputfieldSpecies").value,10),parseInt(document.getElementById("inputfieldLinkNum").value,10))}function round(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function calcSpecTypeInPercent(e){for(var t=0,n=0,r=0,a=0,o=e.nodes.length,i=0;i<o;i++)"top"===e.nodes[i].group?t++:"intermediate"===e.nodes[i].group?n++:"basal"===e.nodes[i].group?r++:"notConnected"===e.nodes[i].group&&a++;return 0===o?[0,0,0]:[round(t/(o-a),2),round(n/(o-a),2),round(r/(o-a),2)]}function displayInTable(e,t){var n=calcSpecTypeInPercent(e),r=e.nodes.length,a=e.links.length;if(document.getElementById(t+"spec").innerHTML=r,document.getElementById(t+"link").innerHTML=a,"random"===t){var o=a/(r*r);document.getElementById(t+"connec").innerHTML=round(o,2)}else{o=a/(r*(r-0));document.getElementById(t+"connec").innerHTML=round(o,2)}document.getElementById(t+"topPercentage").innerHTML=n[0],document.getElementById(t+"intermPercentage").innerHTML=n[1],document.getElementById(t+"basalPercentage").innerHTML=n[2]}function displayTables(){displayInTable(graph1,"random"),displayInTable(graph2,"cascade"),displayInTable(graph3,"niche")}function examplebuttonFkt(e,t,n,r,a,o){document.getElementById("inputfieldSpecies").value=t,document.getElementById("inputfieldLinkNum").value=n,calcDrawTable();var i=document.getElementById("exampleTableEnvironment"),d=i.childNodes,c=document.createElement("table");c.setAttribute("class","table"),c.setAttribute("style","left:100px;"),c.id="tableId";var l=document.createElement("tr"),s=document.createElement("td");s.setAttribute("colspan","2"),s.setAttribute("class","tableLabel"),s.innerHTML=e,l.appendChild(s),c.appendChild(l);var u=document.createElement("tr"),p=document.createElement("th");p.setAttribute("class","tableheader"),p.innerHTML="Eigenschaft";var g=document.createElement("th");g.setAttribute("class","tableheader"),g.innerHTML="Wert",u.appendChild(p),u.appendChild(g),c.appendChild(u);var h=["Spezies","Links","Connectance","Top","Interm","Basal"],m=[t,n,round(n/(t*t),2),r,a,o];for(a=0;a<=5;a++){var f=document.createElement("tr"),v=document.createElement("td"),y=document.createElement("td");v.setAttribute("class","tableEntries"),y.setAttribute("class","tableEntries"),"Connectance"==h[a]&&(v.setAttribute("style","border-bottom: 2px solid black"),y.setAttribute("style","border-bottom: 2px solid black")),v.innerHTML=h[a],y.innerHTML=m[a],f.appendChild(v),f.appendChild(y),c.appendChild(f)}void 0===d[1]?i.appendChild(c):(i.removeChild(document.getElementById("tableId")),i.appendChild(c))}function clearExample(){var e=document.getElementById("exampleTableEnvironment"),t=e.childNodes;void 0!==t[1]&&e.removeChild(document.getElementById("tableId"))}function reloadsvg(e){var t=document.body;oldsvg=document.getElementById(e);var n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS(null,"id",e),n.setAttributeNS(null,"class","svgframes"),t.replaceChild(n,oldsvg)}function reloadScriptFunction(e){document.getElementById("checkdraw").checked&&(reloadsvg("viz1"),reloadsvg("viz2"),reloadsvg("viz3"),drawgraph(graph1,"#viz1",e),drawgraph(graph2,"#viz2",e),drawgraph(graph3,"#viz3",e))}function emptyWindows(){var e={nodes:[],links:[]};reloadsvg("viz1"),reloadsvg("viz2"),reloadsvg("viz3"),drawgraph(e,"#viz1","normal"),drawgraph(e,"#viz2","normal"),drawgraph(e,"#viz3","normal")}function calcDrawTable(){document.getElementById("checkdraw").checked?(calcFinalGraphs(),reloadScriptFunction("normal"),displayTables()):(calcFinalGraphs(),displayTables())}function clearAll(){document.getElementById("inputfieldSpecies").value=0,document.getElementById("inputfieldLinkNum").value=0,calcDrawTable(),clearExample()}function reorder(){function e(e){var t=150,n=2*Math.PI/e.nodes.length;for(i=0;i<e.nodes.length;i++)e.nodes[i].fx=t*Math.cos(i*n)+width/2,e.nodes[i].fy=t*Math.sin(i*n)+height/2;e.nodes[0].isFirst=!0,e.nodes[1].isFirst=!0}e(graph1),e(graph2),e(graph3),reloadScriptFunction("sort")}function normalorder(){function e(e){for(i=0;i<e.nodes.length;i++)e.nodes[i].fx=null,e.nodes[i].fy=null;e.nodes[0].isFirst=!1,e.nodes[1].isFirst=!1}e(graph1),e(graph2),e(graph3),reloadScriptFunction("normal")}function drawgraph(e,t,n){function r(e,t){return e==t||h[e+"-"+t]}function a(){y.call(l),v.call(c)}function o(e){return isFinite(e)?e:0}function i(e){var t=d3.select(d3.event.target).datum().index;y.style("opacity",function(e){return r(t,e.index)?1:.1}),v.style("opacity",function(e){return e.target.index==t?1:.1})}function d(){y.style("opacity",1),v.style("opacity",1)}function c(e){e.attr("d",function(e){var t=o(e.source.x),r=o(e.source.y),a=o(e.target.x),i=o(e.target.y),d=a-t,c=i-r,l=Math.sqrt(d*d+c*c);if("sort"==n)var s=l,u=l;else s=0,u=0;var p=0,g=0,h=0;return t===a&&r===i&&(p=-45,g=1,h=0,s=12,u=12,a-=3,i+=5),"M"+t+","+r+"A"+s+","+u+" "+p+","+g+","+h+" "+a+","+i}),e.attr("fill","transparent")}function l(e){e.attr("transform",function(e){return"translate("+o(e.x)+","+o(e.y)+")"})}function s(e){d3.event.sourceEvent.stopPropagation(),d3.event.active||g.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function u(e){e.fx=d3.event.x,e.fy=d3.event.y}function p(e){d3.event.active||g.alphaTarget(0),e.fx=null,e.fy=null}var g=d3.forceSimulation(e.nodes).force("charge",d3.forceManyBody().strength(-3e3)).force("center",d3.forceCenter(width/2,height/2)).force("x",d3.forceX(width/2).strength(1)).force("y",d3.forceY(height/2).strength(1)).force("path",d3.forceLink(e.links).id(function(e){return e.id}).distance(50).strength(1)).on("tick",a),h=[];e.links.forEach(function(e){h[e.target.index+"-"+e.source.index]=!0});var m=d3.select(t).attr("width",width).attr("height",height),f=m.append("g");m.call(d3.zoom().scaleExtent([.1,4]).on("zoom",function(){f.attr("transform",d3.event.transform)})),f.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",20).attr("refY",0).attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").append("path").attr("fill","#585858").attr("d","M0,-5L10,0L0,5"),f.append("defs").append("marker").attr("id","curvedArrow").attr("viewBox","0 -5 10 10").attr("refX",12).attr("refY",-1).attr("markerWidth",8).attr("markerHeight",8).attr("orient","-20").append("path").attr("fill","#585858").attr("d","M0,-5L10,0L0,5");var v=f.append("g").selectAll("path").data(e.links).enter().append("path").attr("class","path").attr("stroke","#888888").attr("marker-end",function(e){return e.source==e.target?"url(#curvedArrow)":"url(#arrow)"});if("sort"==n){var y=f.selectAll(".node").data(e.nodes).enter().append("g").attr("class","nodes");y.append("circle").attr("r",8).attr("fill",function(e){return"top"===e.group?"#990000":"basal"===e.group?"#245af6":"intermediate"===e.group?"#009900":"notConnected"===e.group?"#000000":void 0}),y.append("text").attr("dx",12).attr("dy",2).text(function(e){if(e.isFirst)return e.id.charAt(1)})}else y=f.append("g").attr("class","nodes").selectAll("g").data(e.nodes).enter().append("circle").attr("r",8).attr("fill",function(e){return"top"===e.group?"#990000":"basal"===e.group?"#245af6":"intermediate"===e.group?"#009900":"notConnected"===e.group?"#000000":void 0});y.call(d3.drag().on("start",s).on("drag",u).on("end",p)),document.getElementById("check").checked&&y.on("mouseover",i).on("mouseout",d)}function calcMultipleTimes(){function e(e){var t=e.nodes.length,n=e.links.length,r=calcSpecTypeInPercent(e);return[t,n,round(n/(t*t),2),r[0],r[1],r[2]]}function t(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length}function n(e){for(var n=t(e),r=0,a=0;a<e.length;a++)r+=Math.pow(e[a]-n,2);return[round(n,2),round(Math.sqrt(r/(e.length-1)),4)]}for(var r,a,o,i=document.getElementById("calcStatInput").value,d=[new Array(i),new Array(i),new Array(i),new Array(i),new Array(i),new Array(i)],c=[new Array(i),new Array(i),new Array(i),new Array(i),new Array(i),new Array(i)],l=[new Array(i),new Array(i),new Array(i),new Array(i),new Array(i),new Array(i)],s=new Array(6),u=new Array(6),p=new Array(6),g=0;g<i;g++){calcFinalGraphs(),r=e(graph1),a=e(graph2),o=e(graph3);for(var h=0;h<6;h++)d[h][g]=r[h],c[h][g]=a[h],l[h][g]=o[h]}for(var m=0;m<6;m++)s[m]=n(d[m]),u[m]=n(c[m]),p[m]=n(l[m]);var f=["randomspec","randomlink","randomconnec","randomtopPercentage","randomintermPercentage","randombasalPercentage"],v=["cascadespec","cascadelink","cascadeconnec","cascadetopPercentage","cascadeintermPercentage","cascadebasalPercentage"],y=["nichespec","nichelink","nicheconnec","nichetopPercentage","nicheintermPercentage","nichebasalPercentage"];for(g=0;g<6;g++)document.getElementById(f[g]).innerHTML=s[g][0]+"|"+s[g][1],document.getElementById(v[g]).innerHTML=u[g][0]+"|"+u[g][1],document.getElementById(y[g]).innerHTML=p[g][0]+"|"+p[g][1]}var graph1,graph2,graph3;calcFinalGraphs(),displayTables();var width=350,height=350;drawgraph(graph1,"#viz1","normal"),drawgraph(graph2,"#viz2","normal"),drawgraph(graph3,"#viz3","normal");